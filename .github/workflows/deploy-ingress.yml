name: Deploy NGINX Ingress Controller

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Deploy NGINX Ingress Controller
        run: |
          echo "Deploying NGINX Ingress Controller..."
          kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml

          echo "Waiting for NGINX Ingress Controller pods to be in 'Running' state..."
          while true; do
              runningPods=$(kubectl get pods -n ingress-nginx --field-selector=status.phase=Running | wc -l)
              if [[ $runningPods -gt 1 ]]; then
                  echo "NGINX Ingress Controller pods are running."
                  break
              fi
              sleep 5
          done
